<a
  [routerLink]="['/product', product.id]"
  class="card product-card text-decoration-none h-100"
>
  <div class="position-relative">
    <div class="thumb">
      <!-- Mostrar imagen o placeholder -->
      <ng-container *ngIf="thumbUrl; else noimg">
        <img
          [src]="thumbUrl"
          class="card-img-top"
          alt="{{ product.name }}"
          style="height: 200px; object-fit: cover;"
          loading="lazy"
          (error)="onImgError($event)" 
        />
      </ng-container>

      <!-- Placeholder -->
      <ng-template #noimg>
        <div class="card-img-top d-grid place-items-center placeholder-thumb">
          <i class="bi bi-image" aria-hidden="true"></i>
          <span class="visually-hidden">Sin imagen</span>
        </div>
      </ng-template>
    </div>

    <!-- Estado de stock -->
    <span
      class="badge position-absolute top-0 start-0 m-2 rounded-pill"
      [ngClass]="product.stock > 0 ? 'text-bg-success' : 'text-bg-danger'"
    >
      {{ product.stock > 0 ? 'En stock' : 'Agotado' }}
    </span>
  </div>

  <!-- Contenido -->
  <div class="card-body d-flex flex-column">
    <h5 class="card-title text-truncate mb-1">{{ product.name }}</h5>

    <p class="card-text text-muted small mb-3 text-truncate" title="{{ product.description }}">
      {{ product.description || 'Sin descripción' }}
    </p>

    <div class="d-flex justify-content-between align-items-center mb-1">
      <span class="badge bg-secondary" *ngIf="product.condition === 'NEW' || product.condition === 'NUEVO'">Nuevo</span>
      <span class="badge bg-warning text-dark" *ngIf="product.condition === 'USED' || product.condition === 'USADO'">Usado</span>
      <span class="text-muted small">Stock: {{ product.stock }}</span>
    </div>

    <div class="d-flex justify-content-between align-items-center mt-auto">
      <strong class="price">
        {{ product.price | currency:'GTQ':'symbol-narrow':'1.2-2' }}
      </strong>
      <small class="text-muted">
        {{ $any(product).category || 'Sin categoría' }}
      </small>
    </div>
  </div>
</a>
