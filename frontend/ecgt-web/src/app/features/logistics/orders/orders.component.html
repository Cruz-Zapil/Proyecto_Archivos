
<div class="surface p-4 rounded-3 shadow-sm">
  <div class="d-flex align-items-center justify-content-between mb-4">
    <h2 class="m-0"><i class="bi bi-truck"></i> Pedidos en curso</h2>
    <button class="btn btn-outline-secondary btn-sm" (click)="load()">
      <i class="bi bi-arrow-repeat"></i> Recargar
    </button>
  </div>

  <!-- Estado de carga -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary"></div>
    <p class="mt-3">Cargando pedidos...</p>
  </div>

  <!-- Sin pedidos -->
  <div *ngIf="!loading && orders.length === 0" class="text-center text-muted py-5">
    <i class="bi bi-inboxes"></i>
    <p class="mt-2">No hay pedidos en curso.</p>
  </div>

  <!-- Tabla -->
  <div *ngIf="!loading && orders.length > 0" class="table-responsive">
    <table class="table align-middle">
      <thead>
        <tr>
          <th>Pedido</th>
          <th>Cliente</th>
          <th>Items</th>
          <th>Total</th>
          <th>Entrega estimada</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let o of orders">
          <td>
            <div class="fw-semibold">{{ o.orderNumber }}</div>
            <div class="text-muted small">{{ o.placedAt | date:'short' }}</div>
          </td>
          <td>
            <div>{{ o.customerName }}</div>
            <div class="text-muted small" *ngIf="o.address">{{ o.address }}</div>
          </td>
          <td>
            <ul class="list-unstyled small mb-0">
              <li *ngFor="let it of o.items">
                ×{{ it.qty }} — {{ it.product.name }}
              </li>
            </ul>
          </td>
          <td class="fw-semibold">
            {{ o.total | currency:'GTQ':'symbol-narrow':'1.2-2' }}
          </td>
          <td style="min-width: 180px;">
            <input
              type="date"
              class="form-control form-control-sm"
              [value]="toDateInput(o.deliveryDate)"
              (change)="changeDeliveryDate(o, $any($event.target)?.value)"
            />
          </td>
          <td class="text-end">
            <button class="btn btn-success btn-sm" (click)="markDelivered(o)">
              <i class="bi bi-check2-circle"></i> Entregado
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Mensaje -->
  <div *ngIf="message" class="alert alert-info mt-3 p-2 small text-center">
    {{ message }}
  </div>
</div>